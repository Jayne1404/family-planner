<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karl & Jayne's Family Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .date-time {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }

        .countdown {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .countdown.green {
            background: #d4edda;
            color: #155724;
        }

        .countdown.orange {
            background: #fff3cd;
            color: #856404;
        }

        .countdown.red {
            background: #f8d7da;
            color: #721c24;
        }

        .info-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .info-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .info-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        /* Main view - person cards */
        .person-card {
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .person-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .person-card.karl {
            border-left: 6px solid #4CAF50;
        }

        .person-card.jayne {
            border-left: 6px solid #E91E63;
        }

        .person-card.shared {
            border-left: 6px solid #FF9800;
        }

        .person-card h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Detail view */
        .detail-view {
            display: none;
        }

        .detail-view.active {
            display: block;
        }

        .back-button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .time-section {
            margin: 30px 0;
        }

        .time-section h3 {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .task-list {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .task-item.has-subtasks {
            background: linear-gradient(135deg, #fff 0%, #f0f0ff 100%);
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
        }

        .task-text {
            flex: 1;
            font-size: 1.1em;
        }

        /* Subtask modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .subtask-list {
            list-style: none;
            padding: 0;
        }

        .subtask-list li {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .close-modal {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
        }

        .close-modal:hover {
            background: #764ba2;
        }

        /* Notes section */
        .notes-section {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }

        .note-item {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            align-items: center;
        }

        .note-text {
            font-size: 1em;
        }

        .seen-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .add-note-button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .celebration {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
        }

        .celebration h2 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .choices {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .choice-button {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: #667eea;
            color: white;
            transition: all 0.3s ease;
        }

        .choice-button:hover {
            transform: scale(1.05);
            background: #764ba2;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }

            .note-item {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Karl & Jayne's Family Planner</h1>
            <div class="date-time" id="datetime"></div>
        </div>

        <div class="countdown" id="countdown">Loading...</div>

        <div class="info-section">
            <h2>üìÖ Today's Information</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>üçΩÔ∏è Tonight's Dinner</h3>
                    <p id="dinner-info">Loading...</p>
                </div>
                <div class="info-card">
                    <h3>üìÜ Today's Appointments</h3>
                    <p id="appointment-info">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Main View -->
        <div id="main-view">
            <div class="person-card karl" onclick="showDetail('karl')">
                <h2>Karl</h2>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="karl-progress">0%</div>
                </div>
            </div>

            <div class="person-card jayne" onclick="showDetail('jayne')">
                <h2>Jayne</h2>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="jayne-progress">0%</div>
                </div>
            </div>

            <div class="person-card shared" onclick="showDetail('shared')">
                <h2>Shared Tasks</h2>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="shared-progress">0%</div>
                </div>
            </div>
        </div>

        <!-- Karl Detail View -->
        <div id="karl-detail" class="detail-view">
            <button class="back-button" onclick="showMain()">‚Üê Back</button>
            <h2>Karl's Tasks</h2>
            <div class="time-section" id="karl-morning-section">
                <h3>üåÖ Morning Tasks</h3>
                <div class="task-list" id="karl-am-tasks"></div>
            </div>
            <div class="time-section" id="karl-evening-section">
                <h3>üåô Evening Tasks</h3>
                <div class="task-list" id="karl-pm-tasks"></div>
            </div>
        </div>

        <!-- Jayne Detail View -->
        <div id="jayne-detail" class="detail-view">
            <button class="back-button" onclick="showMain()">‚Üê Back</button>
            <h2>Jayne's Tasks</h2>
            <div class="time-section" id="jayne-morning-section">
                <h3>üåÖ Morning Tasks</h3>
                <div class="task-list" id="jayne-am-tasks"></div>
            </div>
            <div class="time-section" id="jayne-evening-section">
                <h3>üåô Evening Tasks</h3>
                <div class="task-list" id="jayne-pm-tasks"></div>
            </div>
        </div>

        <!-- Shared Detail View -->
        <div id="shared-detail" class="detail-view">
            <button class="back-button" onclick="showMain()">‚Üê Back</button>
            <h2>Shared Tasks</h2>
            <div class="task-list" id="shared-tasks"></div>
        </div>
    </div>

    <!-- Subtask Modal -->
    <div id="subtask-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Wash Face üßñüèº</h3>
            <ul class="subtask-list" id="modal-subtasks"></ul>
            <button class="close-modal" onclick="closeSubtaskModal()">Done</button>
        </div>
    </div>

    <!-- Celebration -->
    <div class="celebration" id="celebration">
        <h2>üéâ Amazing Work!</h2>
        <p>You finished early! Choose what to do next:</p>
        <div class="choices">
            <button class="choice-button" onclick="startProject('jayne')">üé® Jayne's Project (Set Timer)</button>
            <button class="choice-button" onclick="startProject('karl')">üîß Karl's Project (Set Timer)</button>
            <button class="choice-button" onclick="closeCelebration()">‚ú® Just Relax</button>
        </div>
    </div>

    <script>
        const weekData = {
            Monday: {
                dinner: "Bolognese",
                appointments: "",
                washing: "Jayne",
                karl: {
                    am: [
                        { text: "Wake Up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Make Bed üõèÔ∏è", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    pm: [
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { text: "Put Henry to Bed üõå", completed: false }
                    ],
                    leave: "7:30AM"
                },
                jayne: {
                    am: [
                        { text: "Wake up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes away ü•£", completed: false },
                        { text: "Swap Washing üß∫", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "Cleanser: Korres Greek Yoghurt",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Serum: Boost Lab Vitamin C Brightening",
                                "Moisturiser: Dr Jart+ Ceramidin Cream",
                                "SPF: Mecca Cosmetica To Save Face"
                            ]
                        },
                        { text: "Drop kids üöò", completed: false },
                        { text: "Pick up poo üí©", completed: false },
                        { text: "Walk Molly ü¶Æ", completed: false }
                    ],
                    pm: [
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "First cleanse: Drunk Elephant E-Rase",
                                "Second cleanse: Korres Greek Yoghurt",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Treatment: Boost Lab Retinol",
                                "Moisturiser: DeliKate Recovery Cream"
                            ]
                        },
                        { text: "Pick up Henry üßíüèª", completed: false },
                        { text: "Pick up Sophie üëßüèª", completed: false },
                        { text: "Swap washing üß∫", completed: false },
                        { text: "Put washing away üß£", completed: false },
                        { text: "Walk Molly ü¶Æ", completed: false },
                        { text: "Sophie to bed üõå", completed: false }
                    ],
                    leave: "8:00AM"
                },
                shared: [
                    { text: "Wipe surfaces in office", completed: false },
                    { text: "Wipe surfaces entrance", completed: false },
                    { text: "Wipe surfaces Bedroom", completed: false },
                    { text: "Wipe Surfaces WIR", completed: false },
                    { text: "Change bedding", completed: false },
                    { text: "Vacuum Office", completed: false },
                    { text: "Vacuum Entrance", completed: false },
                    { text: "Vacuum Bedroom", completed: false },
                    { text: "Vacuum WIR", completed: false },
                    { text: "Mop Entrance", completed: false }
                ]
            },
            Tuesday: {
                dinner: "Mac & Cheese",
                appointments: "Sophie prep orientation",
                washing: "Karl",
                karl: {
                    am: [
                        { text: "Wake Up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { text: "Make Bed üõèÔ∏è", completed: false },
                        { text: "Unpack Dishwasher üç¥", completed: false },
                        { text: "Swap Washing üß∫", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { text: "Drop kids üöô", completed: false },
                        { text: "Walk Molly ü¶Æ", completed: false }
                    ],
                    pm: [
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { text: "Pick up kids üöô", completed: false },
                        { text: "Put washing away üß∫", completed: false },
                        { text: "Pick up poo üí©", completed: false },
                        { text: "Put Sophie to bed üõå", completed: false }
                    ],
                    leave: "8:00AM"
                },
                jayne: {
                    am: [
                        { text: "Wake up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "Cleanser: Kate Somerville EradiKate",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Serum: REM Glow / Dew Drops if needed",
                                "Moisturiser: Dr Jart+ Ceramidin Cream",
                                "SPF: Mecca Cosmetica To Save Face"
                            ]
                        }
                    ],
                    pm: [
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { text: "Swap Washing üß∫", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "First cleanse: E-Rase Milki Micellar Water",
                                "Second cleanse: Korres Greek Yoghurt",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Treatment: Boost Lab AHA Glow",
                                "Optional: Boost Lab B3 (5‚Äì10 minutes later)",
                                "Moisturiser: Kate Somerville DeliKate"
                            ]
                        },
                        { text: "Put Henry to bed üõå", completed: false }
                    ],
                    leave: ""
                },
                shared: [
                    { text: "Wipe Surfaces Ensuite", completed: false },
                    { text: "Clean Shower Ensuite", completed: false },
                    { text: "Clean Toilet Ensuite", completed: false },
                    { text: "Clean Kitchen", completed: false },
                    { text: "Clean surfaces Lounge", completed: false },
                    { text: "Change Towels Ensuite", completed: false },
                    { text: "Change Towel Kitchen", completed: false },
                    { text: "Top Up Toilet Paper Ensuite", completed: false },
                    { text: "Top Up Washes Ensuite", completed: false },
                    { text: "Top Up Washes Kitchen", completed: false },
                    { text: "Vacuum Ensuite", completed: false },
                    { text: "Vacuum Kitchen", completed: false },
                    { text: "Vacuum Lounge", completed: false },
                    { text: "Mop Ensuite", completed: false },
                    { text: "Mop Kitchen", completed: false },
                    { text: "Mop Lounge", completed: false }
                ]
            },
            // Wednesday through Sunday would follow the same pattern...
            // For brevity, I'll add just Wednesday
            Wednesday: {
                dinner: "Beef Stroganoff",
                appointments: "Calm Spaces job",
                washing: "Jayne",
                karl: {
                    am: [
                        { text: "Wake Up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Make bed üõèÔ∏è", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    pm: [
                        { text: "Pick up Henry - early üöô", completed: false },
                        { text: "Time with Henry üßíüèª", completed: false },
                        { text: "Pick up Sophie üöô", completed: false },
                        { text: "Swap washing üß∫", completed: false },
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Put Henry to bed üõå", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    leave: ""
                },
                jayne: {
                    am: [
                        { text: "Wake up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes away ü•£", completed: false },
                        { text: "Swap washing üß∫", completed: false },
                        { text: "Pick up poo üí©", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { text: "Drop Kids üöò", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "Cleanse: E-Rase Milki or lukewarm rinse",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Serum: Glow Recipe Hue Drops",
                                "Moisturiser: Dr Jart+ Ceramidin Cream",
                                "SPF: Mecca Cosmetica To Save Face"
                            ]
                        }
                    ],
                    pm: [
                        { text: "Put Washing Away üß∫", completed: false },
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Put Sophie to bed üõå", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "First cleanse: E-Rase Milki Micellar Water",
                                "Second cleanse: Korres Greek Yoghurt",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Treatment: Boost Lab B3 Blemish Rescue",
                                "Moisturiser: DeliKate Recovery Cream"
                            ]
                        }
                    ],
                    leave: "8:00AM"
                },
                shared: [
                    { text: "Wipe surfaces in dining room", completed: false },
                    { text: "Wipe surfaces in laundry", completed: false },
                    { text: "Wipe surfaces in bathroom", completed: false },
                    { text: "Clean shower", completed: false },
                    { text: "Clean bath", completed: false },
                    { text: "Clean toilet", completed: false },
                    { text: "Change towels bathroom", completed: false },
                    { text: "Change towel in laundry", completed: false },
                    { text: "Top up toilet paper", completed: false },
                    { text: "Top up washes", completed: false },
                    { text: "Vacuum dining room", completed: false },
                    { text: "Vacuum laundry", completed: false },
                    { text: "Vacuum bathroom", completed: false },
                    { text: "Vacuum toilet", completed: false },
                    { text: "Mop dining", completed: false },
                    { text: "Mop laundry", completed: false },
                    { text: "Mop bathroom", completed: false },
                    { text: "Mop toilet", completed: false }
                ]
            },
            Thursday: {
                dinner: "Sausages",
                appointments: "Jayne lashes, Karl Hair",
                washing: "Karl",
                karl: {
                    am: [
                        { text: "Wake Up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { text: "Unpack dishwasher üç¥", completed: false },
                        { text: "Make bed üõèÔ∏è", completed: false },
                        { text: "Swap washing üß∫", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { text: "Drop Henry üöô", completed: false }
                    ],
                    pm: [
                        { text: "Pick up Sophie üöô", completed: false },
                        { text: "One on one time with Sophie üëßüèª", completed: false },
                        { text: "Put washing away üß∫", completed: false },
                        { text: "Pick up poo üí©", completed: false },
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Put Sophie to bed üõå", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    leave: "8:20AM"
                },
                jayne: {
                    am: [
                        { text: "Wake up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { text: "Drop Sophie üöò", completed: false },
                        { 
                            text: "Wash face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "Cleanser: Korres Greek Yoghurt",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Serum: REM Glow Daily Vitamin C Gel Cream",
                                "Moisturiser: Dr Jart+ Ceramidin Cream",
                                "SPF: Mecca Cosmetica To Save Face"
                            ]
                        }
                    ],
                    pm: [
                        { text: "Pick up Henry üöò", completed: false },
                        { text: "One one one time Henry üßíüèª", completed: false },
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Swap washing üß∫", completed: false },
                        { text: "Put Henry to bed üõå", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "First cleanse: E-Rase Milki Micellar Water",
                                "Second cleanse: Korres Greek Yoghurt",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Treatment: Go-To Very Amazing Retinal",
                                "Moisturiser: DeliKate Recovery Cream"
                            ]
                        }
                    ],
                    leave: "7:30AM"
                },
                shared: [
                    { text: "Wipe surfaces in play room", completed: false },
                    { text: "Wipe surfaces in Henry room", completed: false },
                    { text: "Wipe surfaces in Sophie's room", completed: false },
                    { text: "Vacuum play room", completed: false },
                    { text: "Vacuum Henry's room", completed: false },
                    { text: "Vacuum Sophie's", completed: false },
                    { text: "Vacuum hallway", completed: false },
                    { text: "Mop hallway", completed: false }
                ]
            },
            Friday: {
                dinner: "Bek's House",
                appointments: "",
                washing: "Jayne",
                karl: {
                    am: [
                        { text: "Wake Up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Make bed üõèÔ∏è", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { text: "Swap washing üß∫", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { text: "Drop Sophie üöô", completed: false }
                    ],
                    pm: [
                        { text: "Henry to bed üõå", completed: false },
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    leave: "7:30AM"
                },
                jayne: {
                    am: [
                        { text: "Wake up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Unpack Dishwasher üç¥", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "Cleanser: EradiKate Daily Foaming Cleanser",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Serum: Boost Lab Vitamin C Brightening Serum",
                                "Moisturiser: Dr Jart+ Ceramidin Cream",
                                "SPF: Mecca Cosmetica To Save Face"
                            ]
                        },
                        { text: "Drop Henry üöò", completed: false }
                    ],
                    pm: [
                        { text: "Pick up Sophie üöò", completed: false },
                        { text: "One one one with Sophie üëßüèª", completed: false },
                        { text: "Pick up Henry üöò", completed: false },
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Swap washing üß∫", completed: false },
                        { text: "Put washing away üß∫", completed: false },
                        { text: "Pick up poo üí©", completed: false },
                        { text: "Sophie to bed üõå", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "First cleanse: Drunk Elephant E-Rase",
                                "Second cleanse: Korres Greek Yoghurt",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Treatment: Go-To Face Hero Face Oil",
                                "Moisturiser: DeliKate Recovery Cream"
                            ]
                        }
                    ],
                    leave: "8:20AM"
                },
                shared: []
            },
            Saturday: {
                dinner: "risotto",
                appointments: "Swimming 10:30AM",
                washing: "Karl",
                karl: {
                    am: [
                        { text: "Wake Up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Make bed üõèÔ∏è", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { text: "Washing away üß∫", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    pm: [
                        { text: "Walk Molly ü¶Æ", completed: false },
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    leave: "10:00AM"
                },
                jayne: {
                    am: [
                        { text: "Wake up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Dishes Away ü•£", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "Cleanser: Korres Greek Yoghurt",
                                "Mask: Go-To The Removalist Clay Mask",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Moisturiser: Dr Jart+ Ceramidin Cream",
                                "SPF: To Save Face"
                            ]
                        }
                    ],
                    pm: [
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "First cleanse: Drunk Elephant E-Rase",
                                "Second cleanse: Korres Greek Yoghurt",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Moisturiser: DeliKate Recovery Cream (add Face Hero if dry)"
                            ]
                        }
                    ],
                    leave: "10:00AM"
                },
                shared: [
                    { 
                        text: "Pack Swimming Bag üèä", 
                        completed: false,
                        subtasks: [
                            "Towels",
                            "Goggles",
                            "Swim Cap",
                            "Change of clothes",
                            "Wet Bag",
                            "Drink Bottles",
                            "Snacks"
                        ]
                    }
                ]
            },
            Sunday: {
                dinner: "Chicken and chips",
                appointments: "",
                washing: "Jayne",
                karl: {
                    am: [
                        { text: "Wake Up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Walk Molly ü¶Æ", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    pm: [
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Clear table üç¥", completed: false },
                        { text: "Teeth ü¶∑", completed: false }
                    ],
                    leave: ""
                },
                jayne: {
                    am: [
                        { text: "Wake up ‚òÄÔ∏è", completed: false },
                        { text: "Shower üöø", completed: false },
                        { text: "Make bed üõèÔ∏è", completed: false },
                        { text: "Breakfast üçû", completed: false },
                        { text: "Coffee ‚òïÔ∏è", completed: false },
                        { text: "Washing away üß∫", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "Cleanser: ExfoliKate or Microfoliant",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Serum: Glow Recipe Watermelon Dew Drops",
                                "Moisturiser: Dr Jart+ Ceramidin Cream",
                                "SPF: To Save Face"
                            ]
                        }
                    ],
                    pm: [
                        { text: "Walk Molly ü¶Æ", completed: false },
                        { text: "Dinner üçΩÔ∏è", completed: false },
                        { text: "Teeth ü¶∑", completed: false },
                        { 
                            text: "Wash Face üßñüèº", 
                            completed: false,
                            subtasks: [
                                "First cleanse: E-Rase Milki Micellar Water",
                                "Second cleanse: EradiKate (oily) Greek (dry)",
                                "Toner: Dr Jart+ Ceramidin Toner",
                                "Eye Serum: Boost Lab Eye Reset Serum",
                                "Eye Cream: Dr Jart+ Ceramidin Eye Cream",
                                "Treatment: Boost Lab B3 Blemish Rescue Serum",
                                "Moisturiser: DeliKate Recovery Cream"
                            ]
                        }
                    ],
                    leave: "8:00AM"
                },
                shared: []
            }
        };

        // Google Sheets API URL
        const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbyABLFWAXqQs-csjm6czL1N4nDMnNmzQlSOF8xwRbbQMEC8Rv_3m6vk_ioabhft3qDH/exec';
        
        let currentDayData = null;

        // Load saved task states from Google Sheets using JSONP
        async function loadTaskStates() {
            return new Promise((resolve) => {
                // Create unique callback name
                const callbackName = 'jsonpCallback_' + Date.now();
                
                // Create callback function
                window[callbackName] = function(data) {
                    resolve(data);
                    // Cleanup
                    delete window[callbackName];
                    document.body.removeChild(script);
                };
                
                // Create script tag for JSONP
                const script = document.createElement('script');
                script.src = `${SHEET_API_URL}?action=load&callback=${callbackName}`;
                script.onerror = function() {
                    console.error('Error loading task states');
                    resolve({});
                    delete window[callbackName];
                    document.body.removeChild(script);
                };
                
                document.body.appendChild(script);
            });
        }

        // Save task state to Google Sheets (using image trick to avoid CORS)
        function saveTaskState(date, person, period, index, completed) {
            try {
                const url = `${SHEET_API_URL}?action=save&date=${date}&person=${person}&period=${period}&index=${index}&completed=${completed}`;
                // Use image request to avoid CORS preflight
                const img = new Image();
                img.src = url;
            } catch (error) {
                console.error('Error saving task state:', error);
            }
        }

        // Apply loaded states to current day data
        function applyTaskStates(taskStates, date) {
            const dateStr = date.toISOString().split('T')[0];
            
            console.log('Applying task states for date:', dateStr);
            console.log('Task states received:', taskStates);
            
            // Apply to Karl's tasks
            currentDayData.karl.am.forEach((task, index) => {
                const key = `${dateStr}_karl_am_${index}`;
                if (taskStates[key] !== undefined) {
                    console.log('Setting Karl AM task', index, 'to', taskStates[key]);
                    task.completed = taskStates[key];
                }
            });
            currentDayData.karl.pm.forEach((task, index) => {
                const key = `${dateStr}_karl_pm_${index}`;
                if (taskStates[key] !== undefined) {
                    console.log('Setting Karl PM task', index, 'to', taskStates[key]);
                    task.completed = taskStates[key];
                }
            });
            
            // Apply to Jayne's tasks
            currentDayData.jayne.am.forEach((task, index) => {
                const key = `${dateStr}_jayne_am_${index}`;
                if (taskStates[key] !== undefined) {
                    console.log('Setting Jayne AM task', index, 'to', taskStates[key]);
                    task.completed = taskStates[key];
                }
            });
            currentDayData.jayne.pm.forEach((task, index) => {
                const key = `${dateStr}_jayne_pm_${index}`;
                if (taskStates[key] !== undefined) {
                    console.log('Setting Jayne PM task', index, 'to', taskStates[key]);
                    task.completed = taskStates[key];
                }
            });
            
            // Apply to Shared tasks
            currentDayData.shared.forEach((task, index) => {
                const key = `${dateStr}_shared__${index}`;
                if (taskStates[key] !== undefined) {
                    console.log('Setting Shared task', index, 'to', taskStates[key]);
                    task.completed = taskStates[key];
                }
            });
            
            console.log('Finished applying task states');
        }

        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('datetime').textContent = now.toLocaleDateString('en-AU', options);
            
            updateCountdown(now);
            updateVisibility(now);
            loadDayData(now);
        }

        function updateVisibility(now) {
            const hours = now.getHours();
            
            // Show morning sections only before noon (12:00)
            const morningSections = document.querySelectorAll('[id$="-morning-section"]');
            morningSections.forEach(section => {
                if (hours < 12) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
            
            // Show evening sections only after 3pm (15:00)
            const eveningSections = document.querySelectorAll('[id$="-evening-section"]');
            eveningSections.forEach(section => {
                if (hours >= 15) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }

        function updateCountdown(now) {
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const currentMinutes = hours * 60 + minutes;
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayName = days[now.getDay()];
            
            let targetTime, targetLabel;
            
            // Check what day it is and set appropriate leave time
            if (dayName === 'Saturday' || dayName === 'Sunday') {
                // Weekend - everyone leaves at 10:00 AM
                if (currentMinutes < 600) { // Before 10:00 AM
                    targetTime = 600; // 10:00 AM
                    targetLabel = "Everyone leaves";
                } else if (currentMinutes < 900) { // Before 3:00 PM
                    targetTime = 900; // 3:00 PM
                    targetLabel = "Evening tasks start";
                } else {
                    document.getElementById('countdown').textContent = "Evening time!";
                    document.getElementById('countdown').className = "countdown green";
                    return;
                }
            } else if (dayName === 'Monday' || dayName === 'Friday') {
                // Karl leaves at 7:30, others at 8:00
                if (currentMinutes < 450) { // Before 7:30 AM
                    targetTime = 450; // 7:30 AM
                    targetLabel = "Karl leaves";
                } else if (currentMinutes < 480) { // Before 8:00 AM
                    targetTime = 480; // 8:00 AM
                    targetLabel = "Everyone else leaves";
                } else if (currentMinutes < 900) { // Before 3:00 PM
                    targetTime = 900; // 3:00 PM
                    targetLabel = "Evening tasks start";
                } else {
                    document.getElementById('countdown').textContent = "Evening time!";
                    document.getElementById('countdown').className = "countdown green";
                    return;
                }
            } else if (dayName === 'Thursday') {
                // Thursday - different leave times
                if (currentMinutes < 450) { // Before 7:30 AM (Jayne leaves)
                    targetTime = 450; // 7:30 AM
                    targetLabel = "Jayne leaves";
                } else if (currentMinutes < 500) { // Before 8:20 AM (Karl leaves)
                    targetTime = 500; // 8:20 AM
                    targetLabel = "Karl leaves";
                } else if (currentMinutes < 900) { // Before 3:00 PM
                    targetTime = 900; // 3:00 PM
                    targetLabel = "Evening tasks start";
                } else {
                    document.getElementById('countdown').textContent = "Evening time!";
                    document.getElementById('countdown').className = "countdown green";
                    return;
                }
            } else {
                // Tuesday, Wednesday - everyone leaves at 8:00 AM
                if (currentMinutes < 480) { // Before 8:00 AM
                    targetTime = 480; // 8:00 AM
                    targetLabel = "Everyone leaves";
                } else if (currentMinutes < 900) { // Before 3:00 PM
                    targetTime = 900; // 3:00 PM
                    targetLabel = "Evening tasks start";
                } else {
                    document.getElementById('countdown').textContent = "Evening time!";
                    document.getElementById('countdown').className = "countdown green";
                    return;
                }
            }
            
            const minutesRemaining = targetTime - currentMinutes;
            const hoursRemaining = Math.floor(minutesRemaining / 60);
            const minsRemaining = minutesRemaining % 60;
            
            const countdownEl = document.getElementById('countdown');
            countdownEl.textContent = `${hoursRemaining}h ${minsRemaining}m until ${targetLabel}`;
            
            if (minutesRemaining > 20) {
                countdownEl.className = "countdown green";
            } else if (minutesRemaining > 10) {
                countdownEl.className = "countdown orange";
            } else {
                countdownEl.className = "countdown red";
            }
        }

        async function loadDayData(now) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayName = days[now.getDay()];
            
            // Temporary - use Monday data if day doesn't exist yet
            currentDayData = weekData[dayName] || weekData['Monday'];
            
            // Load saved task states from Google Sheets
            const taskStates = await loadTaskStates();
            applyTaskStates(taskStates, now);
            
            document.getElementById('dinner-info').textContent = currentDayData.dinner || "No plans";
            document.getElementById('appointment-info').textContent = currentDayData.appointments || "None scheduled";
            
            // Load all tasks
            loadTasks('karl-am-tasks', currentDayData.karl.am, 'karl', 'am');
            loadTasks('karl-pm-tasks', currentDayData.karl.pm, 'karl', 'pm');
            loadTasks('jayne-am-tasks', currentDayData.jayne.am, 'jayne', 'am');
            loadTasks('jayne-pm-tasks', currentDayData.jayne.pm, 'jayne', 'pm');
            loadTasks('shared-tasks', currentDayData.shared, 'shared', '');
            
            updateAllProgress();
        }

        function loadTasks(containerId, tasks, person, period) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            tasks.forEach((task, index) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `task-item ${task.completed ? 'completed' : ''} ${task.subtasks ? 'has-subtasks' : ''}`;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'task-checkbox';
                checkbox.checked = task.completed;
                checkbox.onclick = (e) => {
                    e.stopPropagation();
                    toggleTask(person, period, index);
                };
                
                const label = document.createElement('span');
                label.className = 'task-text';
                label.textContent = task.text;
                
                taskDiv.appendChild(checkbox);
                taskDiv.appendChild(label);
                
                // If has subtasks, make whole div clickable
                if (task.subtasks) {
                    taskDiv.onclick = () => showSubtaskModal(task.text, task.subtasks);
                    taskDiv.style.cursor = 'pointer';
                }
                
                container.appendChild(taskDiv);
            });
        }

        function toggleTask(person, period, index) {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            let completed;
            
            if (person === 'karl') {
                if (period === 'am') {
                    currentDayData.karl.am[index].completed = !currentDayData.karl.am[index].completed;
                    completed = currentDayData.karl.am[index].completed;
                    loadTasks('karl-am-tasks', currentDayData.karl.am, 'karl', 'am');
                } else {
                    currentDayData.karl.pm[index].completed = !currentDayData.karl.pm[index].completed;
                    completed = currentDayData.karl.pm[index].completed;
                    loadTasks('karl-pm-tasks', currentDayData.karl.pm, 'karl', 'pm');
                }
            } else if (person === 'jayne') {
                if (period === 'am') {
                    currentDayData.jayne.am[index].completed = !currentDayData.jayne.am[index].completed;
                    completed = currentDayData.jayne.am[index].completed;
                    loadTasks('jayne-am-tasks', currentDayData.jayne.am, 'jayne', 'am');
                } else {
                    currentDayData.jayne.pm[index].completed = !currentDayData.jayne.pm[index].completed;
                    completed = currentDayData.jayne.pm[index].completed;
                    loadTasks('jayne-pm-tasks', currentDayData.jayne.pm, 'jayne', 'pm');
                }
            } else if (person === 'shared') {
                currentDayData.shared[index].completed = !currentDayData.shared[index].completed;
                completed = currentDayData.shared[index].completed;
                loadTasks('shared-tasks', currentDayData.shared, 'shared', '');
            }
            
            // Save to Google Sheets
            saveTaskState(dateStr, person, period, index, completed);
            
            updateAllProgress();
        }

        function updateAllProgress() {
            updateProgress('karl', [...currentDayData.karl.am, ...currentDayData.karl.pm]);
            updateProgress('jayne', [...currentDayData.jayne.am, ...currentDayData.jayne.pm]);
            updateProgress('shared', currentDayData.shared);
            
            // Check if person completed all their tasks
            checkCelebration('karl', [...currentDayData.karl.am, ...currentDayData.karl.pm]);
            checkCelebration('jayne', [...currentDayData.jayne.am, ...currentDayData.jayne.pm]);
            checkCelebration('shared', currentDayData.shared);
        }

        function checkCelebration(person, tasks) {
            const allCompleted = tasks.every(t => t.completed);
            const totalTasks = tasks.length;
            
            if (allCompleted && totalTasks > 0) {
                // Check if we're 15+ minutes before leave time
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const currentMinutes = hours * 60 + minutes;
                
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                const dayName = days[now.getDay()];
                
                let leaveTime;
                if (dayName === 'Saturday' || dayName === 'Sunday') {
                    leaveTime = 600; // 10:00 AM
                } else if (dayName === 'Monday' || dayName === 'Friday') {
                    leaveTime = 450; // 7:30 AM (earliest)
                } else if (dayName === 'Thursday') {
                    leaveTime = 450; // 7:30 AM (earliest)
                } else {
                    leaveTime = 480; // 8:00 AM
                }
                
                const minutesUntilLeave = leaveTime - currentMinutes;
                
                if (minutesUntilLeave >= 15 && currentMinutes < leaveTime) {
                    const personName = person === 'shared' ? 'Shared Tasks' : person.charAt(0).toUpperCase() + person.slice(1);
                    document.getElementById('celebration').style.display = 'block';
                    document.querySelector('#celebration h2').textContent = `üéâ ${personName} - All Done!`;
                }
            }
        }

        function updateProgress(person, tasks) {
            const completed = tasks.filter(t => t.completed).length;
            const total = tasks.length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const progressBar = document.getElementById(person + '-progress');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
                progressBar.textContent = percentage + '%';
            }
        }

        function showDetail(view) {
            document.getElementById('main-view').style.display = 'none';
            document.querySelectorAll('.detail-view').forEach(el => el.classList.remove('active'));
            document.getElementById(view + '-detail').classList.add('active');
        }

        function showMain() {
            document.getElementById('main-view').style.display = 'block';
            document.querySelectorAll('.detail-view').forEach(el => el.classList.remove('active'));
        }

        function showSubtaskModal(title, subtasks) {
            document.getElementById('modal-title').textContent = title;
            const list = document.getElementById('modal-subtasks');
            list.innerHTML = '';
            
            subtasks.forEach((subtask, index) => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                li.style.gap = '10px';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.style.width = '20px';
                checkbox.style.height = '20px';
                checkbox.style.cursor = 'pointer';
                checkbox.id = `subtask-${index}`;
                
                const label = document.createElement('label');
                label.htmlFor = `subtask-${index}`;
                label.textContent = subtask;
                label.style.flex = '1';
                label.style.cursor = 'pointer';
                
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        label.style.textDecoration = 'line-through';
                        label.style.opacity = '0.6';
                    } else {
                        label.style.textDecoration = 'none';
                        label.style.opacity = '1';
                    }
                    
                    // Check if all subtasks are checked
                    const allChecked = Array.from(list.querySelectorAll('input[type="checkbox"]'))
                        .every(cb => cb.checked);
                    
                    if (allChecked) {
                        setTimeout(() => {
                            alert('üéâ All done with ' + title + '!');
                        }, 300);
                    }
                });
                
                li.appendChild(checkbox);
                li.appendChild(label);
                list.appendChild(li);
            });
            
            document.getElementById('subtask-modal').classList.add('active');
        }

        function closeSubtaskModal() {
            document.getElementById('subtask-modal').classList.remove('active');
        }

        function startProject(person) {
            const minutes = prompt(`How many minutes for ${person}'s project?`);
            if (minutes) {
                alert(`Timer set for ${minutes} minutes!`);
                closeCelebration();
            }
        }

        function closeCelebration() {
            document.getElementById('celebration').style.display = 'none';
        }

        // Initialize
        updateDateTime();
        setInterval(updateDateTime, 60000); // Update every minute
        
        // Auto-refresh to sync with Google Sheets every 30 seconds
        setInterval(() => {
            const now = new Date();
            loadDayData(now);
        }, 30000);
    </script>
</body>
</html>